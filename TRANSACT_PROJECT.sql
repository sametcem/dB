SELECT * FROM AEMP;
SELECT * FROM ADEPT;
SELECT * FROM ASALGRADE;

CREATE TABLE DEPARTMENT
(IdDept INT NOT NULL,
DeptName char(15),
CONSTRAINT DEPARTMENT_PRIMARY_KEY PRIMARY KEY (IdDept));

INSERT INTO DEPARTMENT
 VALUES(15,'SPORT');
 INSERT INTO DEPARTMENT
 VALUES(25,'MEDICAL');
 INSERT INTO DEPARTMENT
 VALUES(35,'CLEANING');

 SELECT * FROM DEPARTMENT;

 CREATE TABLE STAFFMEMBER
 (IdStaffMember INT PRIMARY KEY,
 FirstName char(15),
 LastName char(20),
 DateOfBirth date,
 Position char(20),
 Salary NUMERIC(7,2),
 Email char(30),
 IdDept INT FOREIGN KEY REFERENCES DEPARTMENT(IdDept)
);

DROP TABLE STAFFMEMBER;
SELECT * FROM STAFFMEMBER;

 INSERT INTO STAFFMEMBER
 VALUES(1010,'KEITH','RICHARDS','19760513','ACCOUNTANT',5000,'krichards@g.com',15);
 INSERT INTO STAFFMEMBER
 VALUES(1011,'MICK','JAGGER','19730716','INSTRUCTOR',7500,'mjagger@g.com',25);
 INSERT INTO STAFFMEMBER
 VALUES(1012,'RONNIE','WOOD','19710419','CLEANER',3500,'rwood@g.com',35);
INSERT INTO STAFFMEMBER
 VALUES(1013,'RYAN','BABEL','19760117','CLEANER',2000,'rbabel@g.com',35);
 INSERT INTO STAFFMEMBER
 VALUES(1014,'SAM','BLACK','19850310','INSTRUCTOR',5000,'sblack@g.com',15);
 INSERT INTO STAFFMEMBER
 VALUES(1015,'JOHN','MAYER','19880505','INSTRUCTOR',7000,'jmayer@g.com',25);
 INSERT INTO STAFFMEMBER
 VALUES(1016,'SYLWIA','FLOYD','19941111','INSTRUCTOR',5500,'sfloyd@g.com',15);
 INSERT INTO STAFFMEMBER
 VALUES(1017,'KARINA','JOHANSSON','19830412','ASSISTANT',5000,'kjohansson@g.com',35);
 INSERT INTO STAFFMEMBER
 VALUES(1018,'ALVARO','NEGREDO','19771010','CLEANER',2500,'anegredo@g.com',35);
 INSERT INTO STAFFMEMBER
 VALUES(1019,'EMILIA','ROYAL','19710829','DIRECTOR',9000,'eroyal@g.com',25);
 INSERT INTO STAFFMEMBER
 VALUES(1020,'PABLO','WATERS','19780930','INSTRUCTOR',8000,'pwaters@g.com',35);
 INSERT INTO STAFFMEMBER
 VALUES(1021,'EDDIE','VEDDER','19741117','DIRECTOR',8300,'evedder@g.com',15);
 INSERT INTO STAFFMEMBER
 VALUES(1022,'ERIC','CRAMER','19850221','INSTRUCTOR',700,'ecramer@g.com',15);
 INSERT INTO STAFFMEMBER
 VALUES(1023,'ANTONY','POLLY','19930615','ASSISTANT',4500,'apolly@g.com',25);

 --DELETE FROM STAFFMEMBER WHERE FirstName='RONNIE';
 --UPDATE STAFFMEMBER SET IdStaffMember=1011 where FirstName='KEITH';

  SELECT * FROM STAFFMEMBER;
  SELECT * FROM DEPARTMENT;

  SELECT FIRSTNAME,LASTNAME,SALARY,DeptName
  FROM DEPARTMENT,STAFFMEMBER
  WHERE STAFFMEMBER.IdDept= DEPARTMENT.IdDept
  ORDER BY SALARY;

 CREATE TABLE CLASSES
(IdClasses INT NOT NULL,
StartsHour time,
FinishHour time,
Price NUMERIC(10,2)
CONSTRAINT CLASSES_PRIMARY_KEY PRIMARY KEY (IdClasses));

--DROP TABLE CLASSES;
SELECT * FROM CLASSES;

INSERT INTO CLASSES
 VALUES(01,'17:00:00','19:00:00',50);
 INSERT INTO CLASSES
 VALUES(02,'13:00:00','16:00:00',70);
 INSERT INTO CLASSES
 VALUES(03,'10:00:00','12:00:00',80);
 INSERT INTO CLASSES
 VALUES(04,'17:00:00','19:00:00',90);
 INSERT INTO CLASSES
 VALUES(05,'09:00:00','10:00:00',50);


 CREATE TABLE ORGANISATION
 (IdOrganisation INT PRIMARY KEY,
 IdStaffMember INT FOREIGN KEY REFERENCES STAFFMEMBER(IdStaffMember),
 IdClasses INT FOREIGN KEY REFERENCES CLASSES(IdClasses));

 SELECT * FROM STAFFMEMBER;
 SELECT * FROM ORGANISATION;

 INSERT INTO ORGANISATION
 VALUES(01,1010,03);
  INSERT INTO ORGANISATION
 VALUES(02,1011,01);
  INSERT INTO ORGANISATION
 VALUES(03,1012,01);
  INSERT INTO ORGANISATION
 VALUES(04,1013,02);
  INSERT INTO ORGANISATION
 VALUES(05,1014,02);
  INSERT INTO ORGANISATION
 VALUES(06,1015,03);
  INSERT INTO ORGANISATION
 VALUES(07,1016,04);
  INSERT INTO ORGANISATION
 VALUES(08,1017,02);
  INSERT INTO ORGANISATION
 VALUES(09,1018,03);
  INSERT INTO ORGANISATION
 VALUES(10,1019,01);
  INSERT INTO ORGANISATION
 VALUES(11,1020,05);
  INSERT INTO ORGANISATION
 VALUES(12,1021,02);
  INSERT INTO ORGANISATION
 VALUES(13,1022,01);
  INSERT INTO ORGANISATION
 VALUES(14,1023,03);

  CREATE TABLE SWIMMER
 (IdSwimmer INT PRIMARY KEY,
 FirstName char(15),
 LastName char(20),
 DateOfBirth date,
 PhoneNumber NUMERIC(10,2),
 Email char(50)
);

SELECT * FROM SWIMMER;

INSERT INTO SWIMMER VALUES
(9001,'JAMES','BROWN','1992-04-25',79025589,'jbrown@g.com');
INSERT INTO SWIMMER VALUES
(9002,'ABBY','FLOWER','1993-11-09',79022132,'aflower@g.com');
INSERT INTO SWIMMER VALUES
(9003,'DOROTA','HONEY','1982-09-05',79022359,'dhoney@g.com');
INSERT INTO SWIMMER VALUES
(9004,'MICHEAL','DONARUMMA','1994-04-01',79721892,'mdonarumma@g.com');
INSERT INTO SWIMMER VALUES
(9005,'BETTY','RAMOS','1998-05-03',79273892,'bramos@g.com');
INSERT INTO SWIMMER VALUES
(9006,'HELEN','ELLIOT','1995-04-21',79022349,'helliot@g.com');
INSERT INTO SWIMMER VALUES
(9007,'SANDRA','AGUERO','1982-01-30',72123789,'saguero@g.com');
INSERT INTO SWIMMER VALUES
(9008,'CAROL','WERNER','1999-03-31',76234789,'cwerner@g.com');
INSERT INTO SWIMMER VALUES
(9009,'RUTH','TAYLOR','1990-06-12',98765633,'rtaylor@g.com');
INSERT INTO SWIMMER VALUES
(9010,'DONNA','MARTIN','1993-06-19',74236723,'dmartin@g.com');
INSERT INTO SWIMMER  VALUES
(9011,'RUDY','DAVIES','1996-05-31',73478239,'rdavies@g.com');
INSERT INTO SWIMMER  VALUES
(9012,'CHARLES','WILSON','1991-10-13',75483282,'cwilson@g.com');
INSERT INTO SWIMMER  VALUES
(9013,'JOSEPH','EVANS','1989-03-22',79236427,'jevans@g.com');
INSERT INTO SWIMMER VALUES
(9014,'HELEN','MILLER','1991-05-02',79238938,'hmiller@g.com');
INSERT INTO SWIMMER  VALUES
(9015,'CAROL','GARCIA','1995-04-21',73247839,'cgarcia@g.com');
INSERT INTO SWIMMER VALUES
(9016,'JAMES','MARCUS','1982-01-30',79347730,'jmarcus@g.com');
INSERT INTO SWIMMER  VALUES
(9017,'WILLIAM','FIFTYSIX','1993-09-09',70628233,'wfiftysix@g.com');
INSERT INTO SWIMMER  VALUES
(9018,'DANIEL','GIBSON','1988-04-20',75678902,'dgibson@g.com');
INSERT INTO SWIMMER  VALUES
(9019,'PAUL','FENDER','1993-03-26',72136278,'pfender@g.com');
INSERT INTO SWIMMER  VALUES
(9020,'JEREMY','DUNLOP','1997-08-27',73246783,'jdunlop@g.com');
INSERT INTO SWIMMER  VALUES
(9021,'PAUL','TURTLE','1995-10-30',72137233,'pturtle@g.com');
INSERT INTO SWIMMER  VALUES
(9022,'KIM','STRAWBERRY','1994-03-29',73243728,'kstrawberry@g.com');
INSERT INTO SWIMMER  VALUES
(9023,'YUBIN','HAN','1993-11-22',73284382,'yhan@g.com');
INSERT INTO SWIMMER VALUES
(9024,'FERNANDO','GODIN','1995-07-21',71278322,'fgodin@g.com');
INSERT INTO SWIMMER  VALUES
(9025,'RICARDO','QUARESMA','1998-04-27',79048328,'rquaresma@g.com');
INSERT INTO SWIMMER VALUES
(9026,'CHRIS','CORNELL','1990-02-05',79232232,'ccornell@g.com');
INSERT INTO SWIMMER  VALUES
(9027,'MARCO','SLIM','1990-10-11',79623626,'mslim@g.com');
INSERT INTO SWIMMER VALUES
(9028,'FERNANDO','HART','1997-01-26',79748384,'fhart@g.com');
INSERT INTO SWIMMER VALUES
(9029,'FERNANDO','BONAMASSA','1997-12-21',79052368,'fbonamassa@g.com');
INSERT INTO SWIMMER VALUES
(9030,'SALAH','SWORD','1990-10-11',71237831,'ssword@g.com');

DROP TABLE ITEM;
SELECT * FROM ITEM;

CREATE TABLE ITEM(
IdItem INT PRIMARY KEY,
ItemName char(30),
Price Numeric(10,2));


 INSERT INTO ITEM
 VALUES(01,'POOL NOODLE',10);
  INSERT INTO ITEM
 VALUES(02,'GOGGLES',20);
  INSERT INTO ITEM
 VALUES(03,'SWIM CAP',5);
  INSERT INTO ITEM
 VALUES(04,'ARMBANDS',15);
  INSERT INTO ITEM
 VALUES(05,'SWIM SUIT',50);
  INSERT INTO ITEM
 VALUES(06,'SWIMFIN',20);

 SELECT PRICE "Its price"
 FROM ITEM
 WHERE ITEMNAME='GOGGLES';

 SELECT * FROM ITEM;

 CREATE TABLE PURCHASEITEM
 (IdPurchaseItem INT PRIMARY KEY,
 ItsDate date,
 IdSwimmer INT FOREIGN KEY REFERENCES SWIMMER(IdSwimmer),
 IdItem INT FOREIGN KEY REFERENCES ITEM(IdItem)
);

SELECT * FROM PURCHASEITEM;

INSERT INTO PURCHASEITEM VALUES
(001,'2017-05-30',9003,02);
INSERT INTO PURCHASEITEM VALUES
(002,'2017-05-17',9021,04);
INSERT INTO PURCHASEITEM VALUES
(003,'2017-05-17',9015,04);
INSERT INTO PURCHASEITEM VALUES
(004,'2017-05-09',9009,03);
INSERT INTO PURCHASEITEM VALUES
(005,'2017-04-15',9010,04);
INSERT INTO PURCHASEITEM VALUES
(006,'2017-04-19',9003,01);
INSERT INTO PURCHASEITEM VALUES
(007,'2017-02-06',9011,05);
INSERT INTO PURCHASEITEM VALUES
(008,'2017-01-13',9001,06);

SELECT FIRSTNAME,LastName,ITEMNAME,ItsDate,Price
FROM SWIMMER,ITEM,PURCHASEITEM
WHERE SWIMMER.IdSwimmer = PURCHASEITEM.IdSwimmer AND ITEM.IdItem = PURCHASEITEM.IdItem;

CREATE TABLE IDENTITYCARD
 (IdIdentityCard INT PRIMARY KEY,
 ActivateDate date,
 FinishingDate date NULL,
 IdSwimmer INT FOREIGN KEY REFERENCES Swimmer(IdSwimmer)
);

SELECT * FROM IDENTITYCARD;

INSERT INTO IDENTITYCARD VALUES
(01,'2017-01-01','2019-01-01',9001);
INSERT INTO IDENTITYCARD  VALUES
(02,'2016-01-01','2019-01-01',9002);
INSERT INTO IDENTITYCARD VALUES
(03,'2015-03-01','2019-03-01',9003);
INSERT INTO IDENTITYCARD VALUES
(04,'01-01-2015',NULL,9004);
INSERT INTO IDENTITYCARD VALUES
(05,'2017-07-01','2018-07-01',9005);
INSERT INTO IDENTITYCARD VALUES
(06,'2017-09-01','2020-09-01',9006);
INSERT INTO IDENTITYCARD VALUES
(07,'2016-02-01','2019-02-01',9007);
INSERT INTO IDENTITYCARD VALUES
(08,'2017-03-01','2019-03-01',9008);
INSERT INTO IDENTITYCARD VALUES
(09,'2016-04-01','2019-01-01',9009);
INSERT INTO IDENTITYCARD VALUES
(10,'2015-01-01','2020-01-01',9010);
INSERT INTO IDENTITYCARD VALUES
(11,'2017-01-01','2019-01-01',9011);
INSERT INTO IDENTITYCARD VALUES
(12,'01-01-2013',NULL,9012);
INSERT INTO IDENTITYCARD VALUES
(13,'2014-01-01','2019-01-01',9013);
INSERT INTO IDENTITYCARD VALUES
(14,'2015-01-01','2019-01-01',9014);
INSERT INTO IDENTITYCARD VALUES
(15,'2017-01-01','2019-01-01',9015);
INSERT INTO IDENTITYCARD VALUES
(16,'2013-01-01','2019-01-01',9016);
INSERT INTO IDENTITYCARD VALUES
(17,'2017-01-01','2019-01-01',9017);
INSERT INTO IDENTITYCARD VALUES
(18,'2017-03-01','2019-03-01',9018);
INSERT INTO IDENTITYCARD VALUES
(19,'2017-04-01','2019-01-01',9019);
INSERT INTO IDENTITYCARD VALUES
(20,'01-01-2017',NULL,9020);
INSERT INTO IDENTITYCARD VALUES
(21,'2017-01-01','2019-01-01',9021);
INSERT INTO IDENTITYCARD VALUES
(22,'2017-04-01','2019-01-01',9022);
INSERT INTO IDENTITYCARD VALUES
(23,'01-01-2017',NULL,9023);
INSERT INTO IDENTITYCARD VALUES
(24,'01-01-2016',NULL,9024);
INSERT INTO IDENTITYCARD  VALUES
(25,'2016-01-01','2020-01-01',9025);
INSERT INTO IDENTITYCARD  VALUES
(26,'2017-01-01','2019-01-01',9026);
INSERT INTO IDENTITYCARD  VALUES
(27,'2017-01-01','2019-01-01',9027);
INSERT INTO IDENTITYCARD  VALUES
(28,'2017-01-01', '2020-01-01',9028);
INSERT INTO IDENTITYCARD VALUES
(29,'2017-01-01','2019-01-01',9029);
INSERT INTO IDENTITYCARD VALUES
(30,'2017-04-01','2020-04-01',9030);


 CREATE TABLE SWIMMING
 (IdSwimming INT PRIMARY KEY,
 IdIdentityCard INT FOREIGN KEY REFERENCES IDENTITYCARD(IdIdentityCard),
 IdClasses INT FOREIGN KEY REFERENCES CLASSES(IdClasses));

SELECT * FROM SWIMMING;

 INSERT INTO SWIMMING VALUES
(01,01,01);
INSERT INTO SWIMMING VALUES
(02,02,03);
INSERT INTO SWIMMING VALUES
(03,03,02);
INSERT INTO SWIMMING VALUES
(04,04,05);
INSERT INTO SWIMMING VALUES
(05,05,04);
INSERT INTO SWIMMING VALUES
(06,06,01);
INSERT INTO SWIMMING VALUES
(07,07,01);
INSERT INTO SWIMMING VALUES
(08,08,02);
INSERT INTO SWIMMING VALUES
(09,09,05);
INSERT INTO SWIMMING VALUES
(10,10,04);
INSERT INTO SWIMMING VALUES
(11,11,03);
INSERT INTO SWIMMING VALUES
(12,12,05);
INSERT INTO SWIMMING VALUES
(13,13,02);
INSERT INTO SWIMMING VALUES
(14,14,03);
INSERT INTO SWIMMING VALUES
(15,15,04);
INSERT INTO SWIMMING VALUES
(16,16,04);
INSERT INTO SWIMMING VALUES
(17,17,05);
INSERT INTO SWIMMING VALUES
(18,18,04);
INSERT INTO SWIMMING VALUES
(19,19,03);
INSERT INTO SWIMMING VALUES
(20,20,02);
INSERT INTO SWIMMING VALUES
(21,21,02);
INSERT INTO SWIMMING VALUES
(22,22,02);
INSERT INTO SWIMMING VALUES
(23,23,01);
INSERT INTO SWIMMING VALUES
(24,24,01);
INSERT INTO SWIMMING VALUES
(25,25,03);
INSERT INTO SWIMMING VALUES
(26,26,04);
INSERT INTO SWIMMING VALUES
(27,27,05);
INSERT INTO SWIMMING VALUES
(28,28,02);
INSERT INTO SWIMMING VALUES
(29,29,03);
INSERT INTO SWIMMING VALUES
(30,30,01);

SELECT * FROM POOL;

CREATE TABLE POOL
(IdPool INT NOT NULL,
PoolName char(20),
Capacity NUMERIC(10,2),
PoolLocation char(20), 
CONSTRAINT POOL_PRIMARY_KEY PRIMARY KEY (IdPool));

INSERT INTO POOL VALUES
(01,'SUNPOOLNR1',50,'Centrum');
INSERT INTO POOL VALUES
(02,'BEACHPOOLNR2',30,'Kabaty');

 CREATE TABLE POOLLINE
 (IdPoolLine INT PRIMARY KEY,
 LineNumber NUMERIC(10,2),
 IdPool INT FOREIGN KEY REFERENCES Pool(IdPool)
);

SELECT * FROM POOLLINE;

INSERT INTO POOLLINE VALUES
(01,1,01);
INSERT INTO POOLLINE VALUES
(02,2,01);
INSERT INTO POOLLINE VALUES
(03,3,01);
INSERT INTO POOLLINE VALUES
(04,4,02);
INSERT INTO POOLLINE VALUES
(05,5,02);
INSERT INTO POOLLINE VALUES
(06,6,02);

CREATE TABLE CLASSESINPOOLLINE(
IdCipl INT PRIMARY KEY,
IdClasses INT FOREIGN KEY REFERENCES CLASSES(IdClasses),
IdPoolLine INT FOREIGN KEY REFERENCES POOLLINE(IdPoolLine));


INSERT INTO CLASSESINPOOLLINE VALUES
(01,01,01);
INSERT INTO CLASSESINPOOLLINE VALUES
(02,02,03);
INSERT INTO CLASSESINPOOLLINE VALUES
(03,03,02);
INSERT INTO CLASSESINPOOLLINE VALUES
(04,04,04);
INSERT INTO CLASSESINPOOLLINE VALUES
(05,05,05);

SELECT * FROM CLASSESINPOOLLINE;
--CONTROL TABLES
SELECT * FROM DEPARTMENT;
SELECT * FROM SWIMMER;
SELECT * FROM STAFFMEMBER;
SELECT * FROM ORGANISATION;
SELECT * FROM CLASSES;
SELECT * FROM CLASSESINPOOLLINE;
SELECT * FROM POOLLINE;
SELECT * FROM POOL;
SELECT * FROM SWIMMING;
SELECT * FROM IDENTITYCARD;
SELECT * FROM PURCHASEITEM;
SELECT * FROM ITEM;

SELECT FIRSTNAME,LASTNAME,SALARY,DeptName
FROM DEPARTMENT,STAFFMEMBER
WHERE STAFFMEMBER.IdDept= DEPARTMENT.IdDept
ORDER BY SALARY;

SELECT FIRSTNAME,LastName,ITEMNAME,ItsDate,Price
FROM SWIMMER,ITEM,PURCHASEITEM
WHERE SWIMMER.IdSwimmer = PURCHASEITEM.IdSwimmer AND ITEM.IdItem = PURCHASEITEM.IdItem;


--TRIGGERS
--1
--Whenever you add Departmant,Show message!
GO
 CREATE TRIGGER WARN_MES ON DEPARTMENT
 FOR INSERT 
 AS
 BEGIN
	PRINT 'DEPARTMENT IS ADDED,ADD MORE!'
 END;

 SELECT * FROM DEPARTMENT;
 DELETE FROM DEPARTMENT WHERE IdDept=45;
 INSERT INTO DEPARTMENT VALUES(45,'OPERATION');

 --2
 --You cannot insert a new item with price 0.
 --INSERT/ROLLBACK
GO
CREATE TRIGGER ITEM_CHECK ON Item
FOR INSERT
AS
DECLARE @price DECIMAL(10,2)
SELECT @price = Price FROM inserted
IF @price = 0
BEGIN
	ROLLBACK
	RAISERROR('The price of ITEM CANNOT BE 0.',1,2)
END;

INSERT INTO ITEM VALUES(8,'SWIM BAG',0);
SELECT * FROM ITEM;

 --When you change the salary,it cannot be less than old salary.
 --3 Used system tables(deleted/inserted)
 --UPDATE
 GO
 CREATE TRIGGER SAL_CHECK ON STAFFMEMBER 
 FOR UPDATE
 AS
 BEGIN
 DECLARE @OLDSAL NUMERIC(7,2);
 DECLARE @NEWSAL NUMERIC(7,2);

 SELECT @OLDSAL = Salary FROM deleted;
 SELECT @NEWSAL = Salary FROM inserted;

 if(@OLDSAL > @NEWSAL)
 begin
 print 'New salary cannot be less than old salary';
 Rollback;
 end;
 end;

 SELECT * FROM STAFFMEMBER;
 UPDATE STAFFMEMBER SET Position = 'CLEANER' WHERE IdStaffMember=1013;
 UPDATE STAFFMEMBER SET SALARY = 2100 WHERE IdStaffMember= 1013;

--4
-- When you change salary(bigger than old), position will be Senior automatically.
--UPDATE
GO
CREATE TRIGGER CHANGE_POS ON STAFFMEMBER
FOR UPDATE
AS
DECLARE @SAL_OLD NUMERIC(7,2),@SAL_NEW NUMERIC(7,2), @id INT
SELECT @SAL_OLD = SALARY, @id = IdStaffMember FROM deleted
SELECT @SAL_NEW = SALARY FROM inserted
if @SAL_OLD < @SAL_NEW
	UPDATE STAFFMEMBER SET Position = 'SENIOR' WHERE IdStaffMember = @id


--5 Automatically Delete StaffMembers whose salaries are under 1500
--Cursor
GO
CREATE TRIGGER AUTO_DEL ON STAFFMEMBER
FOR INSERT
AS
IF EXISTS(SELECT IDSTAFFMEMBER FROM inserted WHERE SALARY < 1500)
BEGIN
DECLARE CURS CURSOR FOR SELECT 
IDSTAFFMEMBER FROM inserted WHERE SALARY < 1500;
DECLARE @ID_STAFF INT;
OPEN CURS;
FETCH NEXT FROM CURS INTO @ID_STAFF;
WHILE @@FETCH_STATUS=0
BEGIN
DELETE FROM STAFFMEMBER WHERE IdStaffMember= @ID_STAFF;
FETCH NEXT FROM CURS INTO @ID_STAFF
END;
CLOSE CURS;
END;

--	The FETCH statement was successful = 0
SELECT * FROM STAFFMEMBER;
INSERT INTO STAFFMEMBER VALUES (1027,'Frank','Plant','19810710','JUNIOR',1499,'abrahimi@g.com',25);

--PROCEDURES
--Default Value Director/Deptno 25
GO
CREATE PROCEDURE DEPT_POS
@POS VARCHAR(20) = 'DIRECTOR',@IDDEPT INT=25
AS
BEGIN
SELECT FIRSTNAME,Position,IdDept
FROM STAFFMEMBER
WHERE Position = @POS and IdDept=@IDDEPT;
END;

EXECUTE DEPT_POS
EXECUTE DEPT_POS 'INSTRUCTOR'
EXECUTE DEPT_POS DEFAULT,15

--Procedures in T-SQL may return values as
--1 RESULT SET
--2 PARAMETER OUTPUT
--3 RETURN

--RESULT SET
GO
CREATE PROCEDURE IDCARD_DATA
AS
SELECT ActivateDate,FinishingDate,IdSwimmer
FROM IDENTITYCARD;

EXECUTE IDCARD_DATA

--Parameter by default 'SALAH'
GO
CREATE PROCEDURE CARDD_DATA 
@F_NAME VARCHAR(15) = 'SALAH'
AS
BEGIN
SELECT FirstName,LastName,ActivateDate,FinishingDate
FROM SWIMMER JOIN IDENTITYCARD ON SWIMMER.IdSwimmer = IDENTITYCARD.IdSwimmer
WHERE FirstName = @F_NAME;
END;

SELECT * FROM SWIMMER;
EXECUTE CARDD_DATA 'DONNA'
EXECUTE CARDD_DATA 'JEREMY'

--Add a new Pool and change the content of the table.
--IDPOOL will be generated automatically.
GO
CREATE PROCEDURE POOLL_ADD 
@P_NAME VARCHAR(20), @P_CAP NUMERIC (10,2),@P_LOC VARCHAR(20)
AS
INSERT INTO POOL(IdPool,PoolName,Capacity,PoolLocation)
SELECT ISNULL(MAX(IdPool)+1,1),
@P_NAME,@P_CAP,@P_LOC FROM POOL;

EXECUTE POOLL_ADD 'RAIN',30,'Sluzew'

DELETE FROM POOL WHERE POOLNAME= 'RAIN';
select * from POOL;


--OUTPUT PARAMETER
--Modify salary with given person

GO
CREATE PROCEDURE CHANGE_SAL 
@ID_S INT,@NEW_SAL NUMERIC(7,2) OUTPUT, @PERCENT INT=20
AS
BEGIN
SELECT @NEW_SAL = SALARY + SALARY * @PERCENT/100
FROM STAFFMEMBER
WHERE IdStaffMember = @ID_S;
UPDATE STAFFMEMBER SET SALARY = @NEW_SAL WHERE IdStaffMember = @ID_S;
END;

DECLARE
@NEW_SAL_OUT NUMERIC(7,2)
EXECUTE CHANGE_SAL 1010,@NEW_SAL_OUT OUTPUT;
PRINT @NEW_SAL_OUT;

UPDATE STAFFMEMBER SET  Position ='ASSISTANT' WHERE Firstname='KARINA';

SELECT * FROM STAFFMEMBER;

-- RETURN
-- It may use only for values of procedure of type INT(Because what we return is like function)

GO
CREATE PROCEDURE NUMB_OF_PURCH_ITEM
AS
BEGIN
DECLARE @X INT;
SELECT @X = COUNT(IDPURCHASEITEM) FROM PURCHASEITEM;
RETURN @X;
END;

DECLARE @Y VARCHAR(20);
EXECUTE @Y = NUMB_OF_PURCH_ITEM;
PRINT 'NUMBER OF TOTAL PURCHASES IS:';
PRINT @Y;

SELECT * FROM PURCHASEITEM;

--RETURN DIFFERENCE
GO
CREATE PROCEDURE AGE_DIFF_STAFF
AS
BEGIN
DECLARE @X INT,@Y INT;
SELECT @X = MAX(YEAR(DateOfBirth)) FROM STAFFMEMBER;
SELECT @Y = MIN(YEAR(DateOfBirth)) FROM STAFFMEMBER;
RETURN @X - @Y;
END;

DECLARE @A VARCHAR(20);
EXECUTE @A = AGE_DIFF_STAFF;
PRINT 'AGE RANGE IS';
PRINT @A;

SELECT MAX(DATEOFBIRTH) FROM STAFFMEMBER;
SELECT MIN(DATEOFBIRTH) FROM STAFFMEMBER;




